<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neighbor Park - Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: #f5f5f5;
            color: #000;
        }

        .admin-header {
            background: #000;
            color: #fff;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-title {
            font-size: 24px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .back-btn {
            padding: 10px 20px;
            background: #fff;
            color: #000;
            text-decoration: none;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .container {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 40px;
        }

        .tabs {
            display: flex;
            gap: 0;
            margin-bottom: 40px;
            border-bottom: 2px solid #000;
        }

        .tab-btn {
            padding: 15px 30px;
            background: #fff;
            border: none;
            border-right: 1px solid #ddd;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-btn:last-child {
            border-right: none;
        }

        .tab-btn.active {
            background: #000;
            color: #fff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #fff;
            border: 1px solid #ddd;
        }

        .add-btn {
            padding: 12px 24px;
            background: #000;
            color: #fff;
            border: none;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
        }

        .add-btn:hover {
            background: #333;
        }

        .content-table {
            width: 100%;
            background: #fff;
            border-collapse: collapse;
            border: 1px solid #ddd;
        }

        .content-table th {
            background: #f9f9f9;
            padding: 15px;
            text-align: left;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid #000;
        }

        .content-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .content-table tr:hover {
            background: #f9f9f9;
        }

        .table-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
        }

        .table-image-placeholder {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 24px;
            border-radius: 4px;
        }

        .action-btns {
            display: flex;
            gap: 10px;
        }

        .edit-btn, .delete-btn {
            padding: 6px 12px;
            background: #000;
            color: #fff;
            border: none;
            font-size: 11px;
            text-transform: uppercase;
            cursor: pointer;
        }

        .delete-btn {
            background: #dc3545;
        }

        .edit-btn:hover {
            background: #333;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #fff;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            margin: 20px;
        }

        .modal-header {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 30px;
            text-transform: uppercase;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
        }

        .form-help {
            display: block;
            margin-top: 5px;
            font-size: 11px;
            color: #666;
            font-style: italic;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            font-size: 14px;
            font-family: inherit;
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .upload-method-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .upload-method-btn {
            flex: 1;
            padding: 10px;
            background: #f0f0f0;
            border: 1px solid #ddd;
            cursor: pointer;
            font-size: 12px;
            text-transform: uppercase;
            transition: all 0.3s;
        }

        .upload-method-btn.active {
            background: #000;
            color: #fff;
            border-color: #000;
        }

        .upload-area {
            margin-top: 15px;
            padding: 30px;
            border: 2px dashed #ddd;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }

        .upload-area:hover {
            border-color: #000;
            background: #f5f5f5;
        }

        .upload-area.drag-over {
            border-color: #000;
            background: #e8e8e8;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
            color: #999;
        }

        .upload-text {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .upload-hint {
            font-size: 11px;
            color: #999;
        }

        .file-input {
            display: none;
        }

        .image-preview, .video-preview {
            margin-top: 15px;
            max-width: 100%;
            max-height: 300px;
            border: 1px solid #ddd;
            display: none;
            object-fit: contain;
        }

        .image-preview.show, .video-preview.show {
            display: block;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .save-btn, .cancel-btn {
            flex: 1;
            padding: 12px;
            border: none;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
        }

        .save-btn {
            background: #000;
            color: #fff;
        }

        .cancel-btn {
            background: #ddd;
            color: #000;
        }

        .success-msg {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #28a745;
            color: #fff;
            border-radius: 4px;
            font-size: 14px;
            z-index: 2000;
        }

        .video-indicator {
            display: inline-block;
            padding: 2px 8px;
            background: #28a745;
            color: #fff;
            font-size: 10px;
            border-radius: 3px;
            margin-left: 10px;
        }

        .loading-indicator {
            display: none;
            margin-top: 10px;
            text-align: center;
            color: #666;
            font-size: 12px;
        }

        .loading-indicator.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <h1 class="admin-title">Admin Panel</h1>
        <a href="index.html" class="back-btn">‚Üê Back to Site</a>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" data-tab="documentaries">Films</button>
            <button class="tab-btn" data-tab="articles">Articles</button>
            <button class="tab-btn" data-tab="products">Products</button>
        </div>

        <div id="documentaries-tab" class="tab-content active">
            <div class="action-bar">
                <h2>Manage Films</h2>
                <button class="add-btn" data-type="documentaries">+ Add New Film</button>
            </div>
            <table class="content-table">
                <thead>
                    <tr>
                        <th>Image</th>
                        <th>Title</th>
                        <th>Category</th>
                        <th>Date</th>
                        <th>Video</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="documentaries-table"></tbody>
            </table>
        </div>

        <div id="articles-tab" class="tab-content">
            <div class="action-bar">
                <h2>Manage Articles</h2>
                <button class="add-btn" data-type="articles">+ Add New Article</button>
            </div>
            <table class="content-table">
                <thead>
                    <tr>
                        <th>Image</th>
                        <th>Title</th>
                        <th>Category</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="articles-table"></tbody>
            </table>
        </div>

        <div id="products-tab" class="tab-content">
            <div class="action-bar">
                <h2>Manage Products</h2>
                <button class="add-btn" data-type="products">+ Add New Product</button>
            </div>
            <table class="content-table">
                <thead>
                    <tr>
                        <th>Image</th>
                        <th>Name</th>
                        <th>Category</th>
                        <th>Price</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="products-table"></tbody>
            </table>
        </div>
    </div>

    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <h2 class="modal-header" id="modal-title">Add New Content</h2>
            <form id="edit-form">
                <div id="form-fields"></div>
                <div class="form-actions">
                    <button type="submit" class="save-btn">Save</button>
                    <button type="button" class="cancel-btn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="success-msg" class="success-msg"></div>

    <script src="storage.js"></script>
    <script>
        let currentTab = 'documentaries';
        let currentEditId = null;

        class ContentManager {
            constructor() {
                this.storagePrefix = 'neighborpark_';
            }

            async getContent(type) {
                const key = this.storagePrefix + type;
                try {
                    const result = await window.storage.get(key);
                    const data = result ? JSON.parse(result.value) : [];
                    console.log(`Loaded ${type}:`, data);
                    return data;
                } catch (e) {
                    console.error('Get content error:', e);
                    return [];
                }
            }

            async saveContent(type, data) {
                const key = this.storagePrefix + type;
                try {
                    console.log(`Saving ${type}:`, data);
                    await window.storage.set(key, JSON.stringify(data));
                    console.log(`Saved successfully`);
                    return true;
                } catch (e) {
                    console.error('Save failed:', e);
                    alert('‰øùÂ≠òÂ§±Ë¥•: ' + (e.message || 'Êú™Áü•ÈîôËØØ'));
                    return false;
                }
            }
        }

        const cms = new ContentManager();

        function renderTableImage(imageUrl) {
            if (imageUrl && imageUrl.trim()) {
                return `<img src="${imageUrl}" class="table-image" onerror="this.outerHTML='<div class=\\'table-image-placeholder\\'>üì∑</div>'">`;
            }
            return '<div class="table-image-placeholder">üì∑</div>';
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const tab = this.getAttribute('data-tab');
                switchTab(tab);
            });
        });

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
            document.getElementById(tab + '-tab').classList.add('active');
            loadTable(tab);
        }

        async function loadTable(type) {
            const items = await cms.getContent(type);
            const tbody = document.getElementById(type + '-table');
            
            tbody.innerHTML = items.map(item => {
                if (type === 'products') {
                    return `
                        <tr>
                            <td>${renderTableImage(item.imageUrl)}</td>
                            <td><strong>${item.name}</strong></td>
                            <td>${item.category}</td>
                            <td>¬•${item.price}</td>
                            <td>
                                <div class="action-btns">
                                    <button class="edit-btn" data-type="${type}" data-id="${item.id}">Edit</button>
                                    <button class="delete-btn" data-type="${type}" data-id="${item.id}">Delete</button>
                                </div>
                            </td>
                        </tr>
                    `;
                } else if (type === 'documentaries') {
                    const hasVideo = item.videoUrl ? '<span class="video-indicator">ÊúâËßÜÈ¢ë</span>' : '';
                    return `
                        <tr>
                            <td>${renderTableImage(item.imageUrl)}</td>
                            <td><strong>${item.title}</strong></td>
                            <td>${item.category}</td>
                            <td>${item.date}</td>
                            <td>${hasVideo || '-'}</td>
                            <td>
                                <div class="action-btns">
                                    <button class="edit-btn" data-type="${type}" data-id="${item.id}">Edit</button>
                                    <button class="delete-btn" data-type="${type}" data-id="${item.id}">Delete</button>
                                </div>
                            </td>
                        </tr>
                    `;
                } else {
                    return `
                        <tr>
                            <td>${renderTableImage(item.imageUrl)}</td>
                            <td><strong>${item.title}</strong></td>
                            <td>${item.category}</td>
                            <td>${item.date}</td>
                            <td>
                                <div class="action-btns">
                                    <button class="edit-btn" data-type="${type}" data-id="${item.id}">Edit</button>
                                    <button class="delete-btn" data-type="${type}" data-id="${item.id}">Delete</button>
                                </div>
                            </td>
                        </tr>
                    `;
                }
            }).join('');

            tbody.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    const id = parseInt(this.getAttribute('data-id'));
                    editItem(type, id);
                });
            });

            tbody.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteItem(type, id);
                });
            });
        }

        document.querySelectorAll('.add-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const type = this.getAttribute('data-type');
                openAddModal(type);
            });
        });

        function openAddModal(type) {
            currentEditId = null;
            document.getElementById('modal-title').textContent = 'Add New Content';
            renderForm(type);
            document.getElementById('edit-modal').classList.add('active');
        }

        async function editItem(type, id) {
            currentEditId = id;
            const items = await cms.getContent(type);
            const item = items.find(i => i.id === id);
            
            document.getElementById('modal-title').textContent = 'Edit Content';
            renderForm(type, item);
            document.getElementById('edit-modal').classList.add('active');
        }

        function renderForm(type, data = {}) {
            let formHtml = '';
            
            if (type === 'products') {
                formHtml = `
                    <div class="form-group">
                        <label class="form-label">Product Name *</label>
                        <input type="text" class="form-input" id="name" value="${data.name || ''}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Category *</label>
                        <select class="form-select" id="category" required>
                            <option value="Apparel" ${data.category === 'Apparel' ? 'selected' : ''}>Apparel</option>
                            <option value="Accessories" ${data.category === 'Accessories' ? 'selected' : ''}>Accessories</option>
                            <option value="Stationery" ${data.category === 'Stationery' ? 'selected' : ''}>Stationery</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Price (¬•) *</label>
                        <input type="number" class="form-input" id="price" value="${data.price || ''}" required>
                    </div>
                `;
            } else if (type === 'documentaries') {
                formHtml = `
                    <div class="form-group">
                        <label class="form-label">Title *</label>
                        <input type="text" class="form-input" id="title" value="${data.title || ''}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Category *</label>
                        <select class="form-select" id="category" required>
                            <option value="Music" ${data.category === 'Music' ? 'selected' : ''}>Music</option>
                            <option value="Design" ${data.category === 'Design' ? 'selected' : ''}>Design</option>
                            <option value="Culture" ${data.category === 'Culture' ? 'selected' : ''}>Culture</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Excerpt *</label>
                        <textarea class="form-textarea" id="excerpt" required>${data.excerpt || ''}</textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Date *</label>
                        <input type="date" class="form-input" id="date" value="${data.date || new Date().toISOString().split('T')[0]}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Video</label>
                        <div class="upload-method-tabs">
                            <button type="button" class="upload-method-btn active" data-method="url" data-for="video">URLÈìæÊé•</button>
                            <button type="button" class="upload-method-btn" data-method="upload" data-for="video">Êú¨Âú∞‰∏ä‰º†</button>
                        </div>
                        <input type="url" class="form-input" id="videoUrl" value="${data.videoUrl || ''}" placeholder="https://www.youtube.com/watch?v=...">
                        <span class="form-help">ÊîØÊåÅYouTube„ÄÅBilibili„ÄÅVimeoÊàñÁõ¥Êé•ËßÜÈ¢ëÊñá‰ª∂URL</span>
                        <div id="videoUploadArea" style="display: none;">
                            <div class="upload-area" data-type="video">
                                <div class="upload-icon">üé¨</div>
                                <div class="upload-text">ÁÇπÂáªÊàñÊãñÊãΩËßÜÈ¢ëÊñá‰ª∂Âà∞ËøôÈáå</div>
                                <div class="upload-hint">ÊîØÊåÅ‰ªªÊÑèÊ†ºÂºèÂíåÂ§ßÂ∞è</div>
                            </div>
                            <input type="file" class="file-input" id="videoFile" accept="video/*">
                            <div class="loading-indicator" id="videoLoading">Â§ÑÁêÜ‰∏≠...</div>
                            <video class="video-preview" id="videoPreview" controls></video>
                        </div>
                    </div>
                `;
            } else {
                formHtml = `
                    <div class="form-group">
                        <label class="form-label">Title *</label>
                        <input type="text" class="form-input" id="title" value="${data.title || ''}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Category *</label>
                        <select class="form-select" id="category" required>
                            <option value="Culture" ${data.category === 'Culture' ? 'selected' : ''}>Culture</option>
                            <option value="Interview" ${data.category === 'Interview' ? 'selected' : ''}>Interview</option>
                            <option value="Lifestyle" ${data.category === 'Lifestyle' ? 'selected' : ''}>Lifestyle</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Excerpt *</label>
                        <textarea class="form-textarea" id="excerpt" required>${data.excerpt || ''}</textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Date *</label>
                        <input type="date" class="form-input" id="date" value="${data.date || new Date().toISOString().split('T')[0]}" required>
                    </div>
                `;
            }

            // ÂõæÁâá‰∏ä‰º†ÔºàÈùûÂøÖÂ°´Ôºâ
            formHtml += `
                <div class="form-group">
                    <label class="form-label">Image (Â∞ÅÈù¢ÂõæÁâá - ÂèØÈÄâ)</label>
                    <div class="upload-method-tabs">
                        <button type="button" class="upload-method-btn active" data-method="url" data-for="image">URLÈìæÊé•</button>
                        <button type="button" class="upload-method-btn" data-method="upload" data-for="image">Êú¨Âú∞‰∏ä‰º†</button>
                    </div>
                    <input type="url" class="form-input" id="imageUrl" value="${data.imageUrl || ''}" placeholder="https://example.com/image.jpg">
                    <span class="form-help">Êé®Ëçê‰ΩøÁî®Unsplash„ÄÅImgurÁ≠âÂõæÂ∫äÈìæÊé•</span>
                    <div id="imageUploadArea" style="display: none;">
                        <div class="upload-area" data-type="image">
                            <div class="upload-icon">üì∑</div>
                            <div class="upload-text">ÁÇπÂáªÊàñÊãñÊãΩÂõæÁâáÂà∞ËøôÈáå</div>
                            <div class="upload-hint">ÊîØÊåÅ‰ªªÊÑèÊ†ºÂºèÂíåÂ§ßÂ∞è</div>
                        </div>
                        <input type="file" class="file-input" id="imageFile" accept="image/*">
                        <div class="loading-indicator" id="imageLoading">Â§ÑÁêÜ‰∏≠...</div>
                        <img id="imagePreview" class="image-preview" src="${data.imageUrl || ''}" ${data.imageUrl ? 'class="image-preview show"' : ''}>
                    </div>
                </div>
            `;

            document.getElementById('form-fields').innerHTML = formHtml;
            setupUploadHandlers();
        }

        function setupUploadHandlers() {
            // ÂàáÊç¢‰∏ä‰º†ÊñπÂºè
            document.querySelectorAll('.upload-method-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const method = this.getAttribute('data-method');
                    const forType = this.getAttribute('data-for');
                    
                    this.parentElement.querySelectorAll('.upload-method-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    if (forType === 'image') {
                        if (method === 'url') {
                            document.getElementById('imageUrl').style.display = 'block';
                            document.getElementById('imageUploadArea').style.display = 'none';
                        } else {
                            document.getElementById('imageUrl').style.display = 'none';
                            document.getElementById('imageUploadArea').style.display = 'block';
                        }
                    } else if (forType === 'video') {
                        if (method === 'url') {
                            document.getElementById('videoUrl').style.display = 'block';
                            document.getElementById('videoUploadArea').style.display = 'none';
                        } else {
                            document.getElementById('videoUrl').style.display = 'none';
                            document.getElementById('videoUploadArea').style.display = 'block';
                        }
                    }
                });
            });

            // ÂõæÁâáURLÈ¢ÑËßà
            const imageUrlInput = document.getElementById('imageUrl');
            const imagePreview = document.getElementById('imagePreview');
            
            imageUrlInput.addEventListener('input', function() {
                const url = this.value.trim();
                if (url) {
                    imagePreview.src = url;
                    imagePreview.classList.add('show');
                } else {
                    imagePreview.classList.remove('show');
                }
            });

            // ÂõæÁâáÊñá‰ª∂‰∏ä‰º†
            const imageUploadArea = document.querySelector('[data-type="image"]');
            const imageFileInput = document.getElementById('imageFile');
            const imageLoading = document.getElementById('imageLoading');
            
            if (imageUploadArea && imageFileInput) {
                imageUploadArea.addEventListener('click', () => imageFileInput.click());
                
                imageFileInput.addEventListener('change', async (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        imageLoading.classList.add('show');
                        try {
                            const base64 = await fileToBase64(file);
                            document.getElementById('imageUrl').value = base64;
                            imagePreview.src = base64;
                            imagePreview.classList.add('show');
                        } catch (e) {
                            alert('ÂõæÁâáÂ§ÑÁêÜÂ§±Ë¥•Ôºö' + e.message);
                        } finally {
                            imageLoading.classList.remove('show');
                        }
                    }
                });

                // ÊãñÊãΩ‰∏ä‰º†
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    imageUploadArea.addEventListener(eventName, e => {
                        e.preventDefault();
                        e.stopPropagation();
                    });
                });

                ['dragenter', 'dragover'].forEach(eventName => {
                    imageUploadArea.addEventListener(eventName, () => {
                        imageUploadArea.classList.add('drag-over');
                    });
                });

                ['dragleave', 'drop'].forEach(eventName => {
                    imageUploadArea.addEventListener(eventName, () => {
                        imageUploadArea.classList.remove('drag-over');
                    });
                });

                imageUploadArea.addEventListener('drop', async (e) => {
                    const file = e.dataTransfer.files[0];
                    if (file && file.type.startsWith('image/')) {
                        imageLoading.classList.add('show');
                        try {
                            const base64 = await fileToBase64(file);
                            document.getElementById('imageUrl').value = base64;
                            imagePreview.src = base64;
                            imagePreview.classList.add('show');
                        } catch (e) {
                            alert('ÂõæÁâáÂ§ÑÁêÜÂ§±Ë¥•Ôºö' + e.message);
                        } finally {
                            imageLoading.classList.remove('show');
                        }
                    }
                });
            }

            // ËßÜÈ¢ë‰∏ä‰º†ÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
            if (currentTab === 'documentaries') {
                const videoUploadArea = document.querySelector('[data-type="video"]');
                const videoFileInput = document.getElementById('videoFile');
                const videoPreview = document.getElementById('videoPreview');
                const videoLoading = document.getElementById('videoLoading');
                
                if (videoUploadArea && videoFileInput) {
                    videoUploadArea.addEventListener('click', () => videoFileInput.click());
                    
                    videoFileInput.addEventListener('change', async (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            videoLoading.classList.add('show');
                            try {
                                const base64 = await fileToBase64(file);
                                document.getElementById('videoUrl').value = base64;
                                videoPreview.src = base64;
                                videoPreview.classList.add('show');
                            } catch (e) {
                                alert('ËßÜÈ¢ëÂ§ÑÁêÜÂ§±Ë¥•Ôºö' + e.message);
                            } finally {
                                videoLoading.classList.remove('show');
                            }
                        }
                    });

                    // ÊãñÊãΩ‰∏ä‰º†
                    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                        videoUploadArea.addEventListener(eventName, e => {
                            e.preventDefault();
                            e.stopPropagation();
                        });
                    });

                    ['dragenter', 'dragover'].forEach(eventName => {
                        videoUploadArea.addEventListener(eventName, () => {
                            videoUploadArea.classList.add('drag-over');
                        });
                    });

                    ['dragleave', 'drop'].forEach(eventName => {
                        videoUploadArea.addEventListener(eventName, () => {
                            videoUploadArea.classList.remove('drag-over');
                        });
                    });

                    videoUploadArea.addEventListener('drop', async (e) => {
                        const file = e.dataTransfer.files[0];
                        if (file && file.type.startsWith('video/')) {
                            videoLoading.classList.add('show');
                            try {
                                const base64 = await fileToBase64(file);
                                document.getElementById('videoUrl').value = base64;
                                videoPreview.src = base64;
                                videoPreview.classList.add('show');
                            } catch (e) {
                                alert('ËßÜÈ¢ëÂ§ÑÁêÜÂ§±Ë¥•Ôºö' + e.message);
                            } finally {
                                videoLoading.classList.remove('show');
                            }
                        }
                    });
                }
            }
        }

        document.getElementById('edit-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const items = await cms.getContent(currentTab);
            const formData = {
                imageUrl: document.getElementById('imageUrl').value || '',
                category: document.getElementById('category').value
            };

            if (currentTab === 'products') {
                formData.name = document.getElementById('name').value;
                formData.price = document.getElementById('price').value;
                formData.id = currentEditId || Date.now();
            } else {
                formData.title = document.getElementById('title').value;
                formData.excerpt = document.getElementById('excerpt').value;
                formData.date = document.getElementById('date').value;
                formData.id = currentEditId || Date.now();
                
                if (currentTab === 'documentaries') {
                    formData.videoUrl = document.getElementById('videoUrl').value || '';
                }
            }

            console.log('Form data to save:', formData);

            if (currentEditId) {
                const index = items.findIndex(i => i.id === currentEditId);
                items[index] = formData;
            } else {
                items.push(formData);
            }

            const success = await cms.saveContent(currentTab, items);
            if (success) {
                showSuccess('‰øùÂ≠òÊàêÂäüÔºÅÂÜÖÂÆπÂ∑≤Êõ¥Êñ∞Âà∞‰∏ªÈ°µ„ÄÇ');
                closeModal();
                loadTable(currentTab);
            }
        });

        async function deleteItem(type, id) {
            if (!confirm('Á°ÆÂÆöÂà†Èô§ÂêóÔºü')) return;
            
            const items = await cms.getContent(type);
            const filtered = items.filter(i => i.id !== id);
            
            const success = await cms.saveContent(type, filtered);
            if (success) {
                showSuccess('Âà†Èô§ÊàêÂäüÔºÅ');
                loadTable(type);
            }
        }

        document.querySelector('.cancel-btn').addEventListener('click', closeModal);

        function closeModal() {
            document.getElementById('edit-modal').classList.remove('active');
        }

        function showSuccess(message) {
            const msg = document.getElementById('success-msg');
            msg.textContent = message;
            msg.style.display = 'block';
            setTimeout(() => {
                msg.style.display = 'none';
            }, 3000);
        }

        loadTable('documentaries');
    </script>
</body>
</html>
